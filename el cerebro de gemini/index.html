<!DOCTYPE html>
<html lang="es" data-color-scheme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Cartas Catastrales - CloudRun AI</title>
    <meta name="description" content="Herramienta de análisis inteligente de documentos catastrales usando AI">
    <meta name="theme-color" content="#0f172a">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><rect x='3' y='4' width='18' height='16' fill='%234285f4' rx='2'/><path d='M7 8h10M7 12h6M7 16h8' stroke='white' stroke-width='1.5' stroke-linecap='round'/></svg>">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="estilos-adicionales.css">
    <script src="https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="4" width="18" height="16" fill="#4285f4" rx="2"/>
                        <path d="M7 8h10M7 12h6M7 16h8" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <h1>CloudRun AI Catastral</h1>
                    <span class="header-subtitle">Análisis inteligente de documentos</span>
                </div>
                <div class="header-controls">
                    <div class="connection-status" id="connectionStatus">
                        <span class="status-indicator online"></span>
                        <span class="status-text">Listo</span>
                    </div>
                </div>
            </div>
        </header>


        <!-- Main Analysis Section -->
        <section class="analysis-section">
            <div class="analysis-container">
                <!-- Navigation Tabs -->
                <div class="analysis-nav">
                    <div class="nav-tabs">
                        <button class="nav-tab active" data-tab="ocr">OCR + IA</button>
                        <button class="nav-tab" data-tab="validation">Validación</button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- OCR + IA Tab -->
                    <div id="ocrTab" class="tab-panel active">
                        <div class="panel-split">
                            <!-- Left Panel - Document Upload -->
                            <div class="panel-left">
                                <div class="panel-header">
                                    <h3 id="uploadSectionTitle">Documentos de Propiedad</h3>
                                    <div class="document-type-slider">
                                        <div class="slider-container">
                                            <input type="radio" name="docType" id="propiedadType" value="propiedad" checked>
                                            <input type="radio" name="docType" id="gravamenType" value="gravamen">
                                            <div class="slider-labels">
                                                <label for="propiedadType" class="slider-label">Documentos de Propiedad</label>
                                                <label for="gravamenType" class="slider-label">Documentos de Gravamen</label>
                                            </div>
                                            <div class="slider-indicator"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Upload Section -->
                                <div class="upload-section-compact">
                                    <h4 id="uploadTitle">Carga de Documentos de Propiedad</h4>
                                    <div class="upload-area-compact" id="uploadAreaCompact">
                                        <div class="upload-content-compact">
                                            <div class="upload-icon">📄</div>
                                            <p>Arrastra y suelta tus documentos aquí</p>
                                            <p class="upload-hint">o</p>
                                            <button type="button" class="btn btn--primary btn--sm" id="selectFilesBtn">
                                                Seleccionar Archivos
                                            </button>
                                        </div>
                                        <div class="upload-specs-compact">
                                            <small>Formatos soportados: PDF con texto. Tamaño máximo: 30 MB.</small>
                                        </div>
                                        <input type="file" id="fileInputCompact" multiple accept="application/pdf,image/*" style="display: none;">
                                    </div>
                                </div>

                                <!-- Uploaded Files List -->
                                <div class="uploaded-files-section">
                                    <h4 id="uploadedFilesTitle">Archivos Subidos (Propiedad)</h4>
                                    <div id="uploadedFilesList" class="uploaded-files-list">
                                        <!-- Files will be dynamically added here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Right Panel - Extracted Data -->
                            <div class="panel-right">
                                <div class="panel-header">
                                    <h3>Datos Extraídos (Propiedad)</h3>
                                    <div class="panel-tabs">
                                        <button class="panel-tab active" data-panel="tables">Tablas</button>
                                        <button class="panel-tab" data-panel="chat">Chat</button>
                                    </div>
                                </div>

                                <!-- Tables Panel -->
                                <div id="tablesPanel" class="data-panel active">
                                    <div id="extractedDataContainer" class="extracted-data-container">
                                        <!-- No data message (initially shown) -->
                                        <div id="noDataMessage" class="no-data-placeholder">
                                            <div class="no-data-icon">📄</div>
                                            <h4>No hay datos extraídos</h4>
                                            <p>Sube un documento para ver los datos extraídos aquí.</p>
                                        </div>

                                        <!-- Property Information Card -->
                                        <div class="data-card" id="informacionPredioCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">🏠</div>
                                                <h4>Información del Predio</h4>
                                            </div>
                                            <div class="card-content" id="informacionPredioContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Measurements and Boundaries Card -->
                                        <div class="data-card" id="medidasColindanciasCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">📐</div>
                                                <h4>Medidas y Colindancias</h4>
                                            </div>
                                            <div class="card-content" id="medidasColindanciasContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Titulares Card (Propiedad only) -->
                                        <div class="data-card" id="titularesCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">👥</div>
                                                <h4>Titulares</h4>
                                            </div>
                                            <div class="card-content" id="titularesContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Acto Jurídico Card -->
                                        <div class="data-card" id="actoJuridicoCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">⚖️</div>
                                                <h4>Acto Jurídico</h4>
                                            </div>
                                            <div class="card-content" id="actoJuridicoContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Datos Registrales Card -->
                                        <div class="data-card" id="datosRegistralesCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">📜</div>
                                                <h4>Datos Registrales</h4>
                                            </div>
                                            <div class="card-content" id="datosRegistralesContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Antecedentes Card (Propiedad only) -->
                                        <div class="data-card" id="antecedentesCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">📚</div>
                                                <h4>Antecedentes</h4>
                                            </div>
                                            <div class="card-content" id="antecedentesContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Calidad de Extracción Card -->
                                        <div class="data-card" id="calidadExtraccionCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">🎯</div>
                                                <h4>Calidad de Extracción</h4>
                                            </div>
                                            <div class="card-content" id="calidadExtraccionContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Chat Panel -->
                                <div id="chatPanel" class="data-panel">
                                    <div id="chatMessages" class="chat-messages">
                                        <div class="welcome-message">
                                            <div class="welcome-icon">💬</div>
                                            <h4>Chat con IA</h4>
                                            <p>Procesa documentos y haz preguntas sobre los datos extraídos</p>
                                            <p>La IA puede ayudarte a entender y analizar la información de tus documentos</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Chat Input -->
                                    <div class="chat-input-container">
                                        <div class="chat-input-wrapper">
                                            <textarea 
                                                id="chatInput" 
                                                class="chat-input" 
                                                rows="2"
                                                placeholder="Pregunta sobre los datos extraídos..."
                                                disabled
                                            ></textarea>
                                            <button id="sendChatMessage" class="chat-send-btn" type="button" disabled>
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                                    <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Validation Tab -->
                    <div id="validationTab" class="tab-panel">
                        <div class="validation-content">
                            <div class="validation-info">
                                <h3>Validación de Documentos</h3>
                                <p>Esta sección te permite validar y comparar documentos de gravamen con los documentos de propiedad ya procesados.</p>
                                
                                <div class="validation-features">
                                    <div class="validation-feature">
                                        <div class="feature-icon">📋</div>
                                        <div class="feature-content">
                                            <h4>Comparación Automática</h4>
                                            <p>Compara automáticamente los datos entre documentos de propiedad y gravamen.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="validation-feature">
                                        <div class="feature-icon">⚠️</div>
                                        <div class="feature-content">
                                            <h4>Detección de Inconsistencias</h4>
                                            <p>Identifica diferencias o inconsistencias entre los documentos.</p>
                                        </div>
                                    </div>
                                    
                                    <div class="validation-feature">
                                        <div class="feature-icon">📊</div>
                                        <div class="feature-content">
                                            <h4>Reporte de Validación</h4>
                                            <p>Genera un reporte detallado con los resultados de la validación.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="upload-area-compact">
                                <div class="upload-content-compact">
                                    <div class="upload-icon">📁</div>
                                    <p>Arrastra documentos de gravamen aquí</p>
                                    <p class="upload-hint">o</p>
                                    <button type="button" class="btn btn--secondary btn--sm">
                                        Seleccionar Archivos de Gravamen
                                    </button>
                                </div>
                                <div class="upload-specs-compact">
                                    <small>Sube primero documentos de propiedad en la pestaña OCR + IA</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">Procesando documentos...</p>
            <div id="loadingProgress" class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h3>Exportar Resultados</h3>
            <div class="export-options">
                <button class="export-option" data-format="json">
                    <strong>JSON</strong>
                    <small>Datos estructurados</small>
                </button>
                <button class="export-option" data-format="csv">
                    <strong>CSV</strong>
                    <small>Tabla comparativa</small>
                </button>
                <button class="export-option" data-format="summary">
                    <strong>Resumen Ejecutivo</strong>
                    <small>Texto consolidado</small>
                </button>
            </div>
            <div class="modal-actions">
                <button id="closeExportModal" class="btn btn--outline">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
