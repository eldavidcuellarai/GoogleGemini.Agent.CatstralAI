<!DOCTYPE html>
<html lang="es" data-color-scheme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Cartas Catastrales - CloudRun AI</title>
    <meta name="description" content="Herramienta de an√°lisis inteligente de documentos catastrales usando AI">
    <meta name="theme-color" content="#1f2937">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><rect x='3' y='4' width='18' height='16' fill='%234285f4' rx='2'/><path d='M7 8h10M7 12h6M7 16h8' stroke='white' stroke-width='1.5' stroke-linecap='round'/></svg>">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="estilos-adicionales.css">
    <style>
        /* Forzar modo oscuro permanente */
        :root {
            color-scheme: dark;
            --color-scheme: dark;
            --color-bg: #0f172a;
            --color-bg-1: #1e293b;
            --color-bg-2: #334155;
            --color-bg-3: #475569;
            --color-surface: #1e293b;
            --color-border: #374151;
            --color-text: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-primary: #3b82f6;
            --color-primary-hover: #2563eb;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #dc2626;
            --color-data-card-bg: #1e293b;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
        }
        
        body {
            background: var(--color-bg);
            color: var(--color-text);
        }
        
        /* Ocultar el bot√≥n de cambio de tema */
        #themeToggle {
            display: none !important;
        }
        
        /* Asegurar que todos los elementos tengan el tema oscuro */
        .header {
            background: var(--color-bg-1) !important;
            border-bottom: 1px solid var(--color-border) !important;
        }
        
        .config-section {
            background: var(--color-bg) !important;
        }
        
        .upload-section {
            background: var(--color-bg-1) !important;
        }
        
        .analysis-section {
            background: var(--color-bg) !important;
        }
        
        .modal {
            background: rgba(0, 0, 0, 0.8) !important;
        }
        
        .modal-content {
            background: var(--color-surface) !important;
            border: 1px solid var(--color-border) !important;
        }

        /* Additional dark mode styles */
        button, input, textarea, select {
            background-color: var(--color-bg-2) !important;
            color: var(--color-text) !important;
            border-color: var(--color-border) !important;
        }

        .btn--primary {
            background-color: var(--color-primary) !important;
            color: white !important;
        }

        .btn--primary:hover {
            background-color: var(--color-primary-hover) !important;
        }

        .data-card {
            background-color: var(--color-data-card-bg) !important;
            border-color: var(--color-border) !important;
        }

        .feature-card {
            background-color: var(--color-bg-2) !important;
            border-color: var(--color-border) !important;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="4" width="18" height="16" fill="#3b82f6" rx="2"/>
                        <path d="M7 8h10M7 12h6M7 16h8" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <h1>CloudRun AI Catastral</h1>
                    <span class="header-subtitle">An√°lisis inteligente de documentos</span>
                </div>
                <div class="header-controls">
                    <div class="connection-status" id="connectionStatus">
                        <span class="status-indicator offline"></span>
                        <span class="status-text">Sin configurar</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Configuration Section -->
        <section class="config-section">
            <div class="config-container">
                <h2>Configuraci√≥n</h2>
                <div class="config-form">
                    <div class="config-header">
                        <div class="config-icon">‚öôÔ∏è</div>
                        <div>
                            <p class="config-description">Configura tu API Key de Google AI Studio para comenzar</p>
                            <a href="https://makersuite.google.com/app/apikey" target="_blank" class="config-link">Obtener API Key ‚Üí</a>
                        </div>
                    </div>
                    
                    <div class="config-form-grid">
                        <!-- API Key Input -->
                        <div class="form-group">
                            <label for="apiKey" class="form-label">
                                <span class="label-text">API Key de Google AI Studio</span>
                                <span class="required">*</span>
                            </label>
                            <div class="api-key-input">
                                <input 
                                    type="password" 
                                    id="apiKey" 
                                    class="form-control" 
                                    placeholder="Ingresa tu API Key de Google AI Studio..."
                                    required
                                >
                                <button type="button" id="toggleApiKey" class="btn btn--outline btn--sm">
                                    <span class="show-text">üëÅÔ∏è</span>
                                </button>
                            </div>
                            <p class="form-hint">Tu API Key se almacena localmente y nunca se comparte.</p>
                        </div>

                        <!-- System Prompt (Optional) -->
                        <div class="form-group">
                            <label for="systemPrompt" class="form-label">
                                <span class="label-text">Prompt del Sistema (Opcional)</span>
                            </label>
                            <textarea 
                                id="systemPrompt" 
                                class="form-control system-prompt-textarea" 
                                rows="4"
                                placeholder="Instrucciones adicionales para personalizar el an√°lisis..."
                            >Eres un experto analista de documentos catastrales y notariales mexicanos. Extrae datos con precisi√≥n, identifica patrones y proporciona an√°lisis detallados de propiedades.</textarea>
                        </div>
                    </div>

                    <!-- Save Configuration -->
                    <div class="config-actions">
                        <button id="saveConfig" class="btn btn--primary">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                <polyline points="17,21 17,13 7,13 7,21"/>
                                <polyline points="7,3 7,8 15,8"/>
                            </svg>
                            Guardar Configuraci√≥n
                        </button>
                    </div>
                    
                    <!-- Configuration Status -->
                    <div id="configStatus" class="config-status hidden">
                        <div class="status-message">
                            <span class="status-icon">‚úÖ</span>
                            <span class="status-text">Configuraci√≥n guardada correctamente</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Start Info Section -->
        <section class="upload-section">
            <div class="upload-container">
                <h3>An√°lisis de Documentos Catastrales</h3>
                <div class="quick-start-info">
                    <p class="quick-start-description">Configura tu API Key arriba y luego dir√≠gete a la secci√≥n de an√°lisis para subir documentos PDF.</p>
                    <div class="features-grid">
                        <div class="feature-card">
                            <span class="feature-icon">üè†</span>
                            <h4>Documentos de Propiedad</h4>
                            <p>Extrae datos completos de escrituras y documentos de propiedad</p>
                        </div>
                        <div class="feature-card">
                            <span class="feature-icon">‚öñÔ∏è</span>
                            <h4>Documentos de Gravamen</h4>
                            <p>Analiza hipotecas, embargos y otros grav√°menes</p>
                        </div>
                        <div class="feature-card">
                            <span class="feature-icon">ü§ñ</span>
                            <h4>IA Avanzada</h4>
                            <p>Procesamiento inteligente con Google Gemini AI</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Analysis Section -->
        <section class="analysis-section">
            <div class="analysis-container">
                <!-- Navigation Tabs -->
                <div class="analysis-nav">
                    <div class="nav-tabs">
                        <button class="nav-tab active" data-tab="ocr">An√°lisis de Documentos</button>
                        <button class="nav-tab" data-tab="validation">Validaci√≥n y Chat</button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- OCR + IA Tab -->
                    <div id="ocrTab" class="tab-panel active">
                        <div class="panel-split">
                            <!-- Left Panel - Document Upload -->
                            <div class="panel-left">
                                <div class="panel-header">
                                    <h3 id="uploadSectionTitle">Documentos de Propiedad</h3>
                                    <div class="document-type-slider">
                                        <div class="slider-container">
                                            <input type="radio" name="docType" id="propiedadType" value="propiedad" checked>
                                            <input type="radio" name="docType" id="gravamenType" value="gravamen">
                                            <div class="slider-labels">
                                                <label for="propiedadType" class="slider-label">Documentos de Propiedad</label>
                                                <label for="gravamenType" class="slider-label">Documentos de Gravamen</label>
                                            </div>
                                            <div class="slider-indicator"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Upload Section -->
                                <div class="upload-section-compact">
                                    <h4 id="uploadTitle">Carga de Documentos de Propiedad</h4>
                                    <div class="upload-area-compact" id="uploadAreaCompact">
                                        <div class="upload-content-compact">
                                            <div class="upload-icon">üìÅ</div>
                                            <p>Arrastra y suelta tus documentos aqu√≠</p>
                                            <p class="upload-hint">o</p>
                                            <button type="button" class="btn btn--primary btn--sm" id="selectFilesBtn">
                                                Seleccionar Archivos
                                            </button>
                                        </div>
                                        <div class="upload-specs-compact">
                                            <small>Formatos soportados: PDF con texto, im√°genes PNG/JPEG. Tama√±o m√°ximo: 20 MB por archivo.</small>
                                        </div>
                                        <input type="file" id="fileInputCompact" multiple accept="application/pdf,image/*" style="display: none;">
                                    </div>
                                </div>

                                <!-- Uploaded Files List -->
                                <div class="uploaded-files-section">
                                    <h4 id="uploadedFilesTitle">Archivos Procesados (Propiedad)</h4>
                                    <div id="uploadedFilesList" class="uploaded-files-list">
                                        <!-- Files will be dynamically added here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Right Panel - Extracted Data -->
                            <div class="panel-right">
                                <div class="panel-header">
                                    <h3>Datos Extra√≠dos</h3>
                                    <div class="panel-tabs">
                                        <button class="panel-tab active" data-panel="tables">Tablas</button>
                                        <button class="panel-tab" data-panel="chat">Chat</button>
                                    </div>
                                </div>

                                <!-- Tables Panel -->
                                <div id="tablesPanel" class="data-panel active">
                                    <div id="extractedDataContainer" class="extracted-data-container">
                                        <!-- No data message (initially shown) -->
                                        <div id="noDataMessage" class="no-data-placeholder">
                                            <div class="no-data-icon">üìÑ</div>
                                            <h4>No hay datos extra√≠dos</h4>
                                            <p>Sube un documento para ver los datos extra√≠dos aqu√≠.</p>
                                        </div>

                                        <!-- Property Information Card -->
                                        <div class="data-card" id="informacionPredioCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">üè†</div>
                                                <h4>Informaci√≥n del Predio</h4>
                                            </div>
                                            <div class="card-content" id="informacionPredioContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Measurements and Boundaries Card -->
                                        <div class="data-card" id="medidasColindanciasCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">üìê</div>
                                                <h4>Medidas y Colindancias</h4>
                                            </div>
                                            <div class="card-content" id="medidasColindanciasContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Titulares Card (Propiedad only) -->
                                        <div class="data-card" id="titularesCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">üë•</div>
                                                <h4>Titulares</h4>
                                            </div>
                                            <div class="card-content" id="titularesContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Acto Jur√≠dico Card -->
                                        <div class="data-card" id="actoJuridicoCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">‚öñÔ∏è</div>
                                                <h4>Acto Jur√≠dico</h4>
                                            </div>
                                            <div class="card-content" id="actoJuridicoContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Datos Registrales Card -->
                                        <div class="data-card" id="datosRegistralesCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">üìú</div>
                                                <h4>Datos Registrales</h4>
                                            </div>
                                            <div class="card-content" id="datosRegistralesContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Antecedentes Card (Propiedad only) -->
                                        <div class="data-card" id="antecedentesCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">üìö</div>
                                                <h4>Antecedentes</h4>
                                            </div>
                                            <div class="card-content" id="antecedentesContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Gravamen Card (Gravamen only) -->
                                        <div class="data-card" id="gravamenCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">üèõÔ∏è</div>
                                                <h4>Informaci√≥n del Gravamen</h4>
                                            </div>
                                            <div class="card-content" id="gravamenContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>

                                        <!-- Calidad de Extracci√≥n Card -->
                                        <div class="data-card" id="calidadExtraccionCard" style="display: none;">
                                            <div class="card-header">
                                                <div class="card-icon">üéØ</div>
                                                <h4>Calidad de Extracci√≥n</h4>
                                            </div>
                                            <div class="card-content" id="calidadExtraccionContent">
                                                <!-- Dynamic content will be added here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Chat Panel -->
                                <div id="chatPanel" class="data-panel">
                                    <div id="chatMessages" class="chat-messages">
                                        <div class="welcome-message">
                                            <div class="welcome-icon">ü§ñ</div>
                                            <h4>Chat con IA</h4>
                                            <p>Procesa documentos y haz preguntas sobre los datos extra√≠dos</p>
                                            <p>La IA puede ayudarte a entender y analizar la informaci√≥n de tus documentos</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Chat Input -->
                                    <div class="chat-input-container">
                                        <div class="chat-input-wrapper">
                                            <textarea 
                                                id="chatInput" 
                                                class="chat-input" 
                                                rows="2"
                                                placeholder="Pregunta sobre los datos extra√≠dos..."
                                                disabled
                                            ></textarea>
                                            <button id="sendChatMessage" class="chat-send-btn" type="button" disabled>
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                                    <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Validation Tab -->
                    <div id="validationTab" class="tab-panel">
                        <div class="validation-content">
                            <div class="validation-info">
                                <h3>üîç Validaci√≥n y An√°lisis Comparativo</h3>
                                <p>Esta secci√≥n permite validar los datos extra√≠dos y realizar an√°lisis comparativos entre documentos.</p>
                                
                                <div class="validation-features">
                                    <div class="validation-feature">
                                        <span class="feature-icon">‚úÖ</span>
                                        <div>
                                            <h4>Validaci√≥n Autom√°tica</h4>
                                            <p>Verifica la consistencia de los datos extra√≠dos</p>
                                        </div>
                                    </div>
                                    
                                    <div class="validation-feature">
                                        <span class="feature-icon">üìä</span>
                                        <div>
                                            <h4>An√°lisis Comparativo</h4>
                                            <p>Compara m√∫ltiples documentos y encuentra diferencias</p>
                                        </div>
                                    </div>
                                    
                                    <div class="validation-feature">
                                        <span class="feature-icon">üéØ</span>
                                        <div>
                                            <h4>M√©tricas de Calidad</h4>
                                            <p>Eval√∫a la confiabilidad de los datos extra√≠dos</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">Procesando documentos...</p>
            <div id="loadingProgress" class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h3>Exportar Resultados</h3>
            <div class="export-options">
                <button class="export-option" data-format="json">
                    <strong>JSON</strong>
                    <small>Datos estructurados</small>
                </button>
                <button class="export-option" data-format="csv">
                    <strong>CSV</strong>
                    <small>Tabla comparativa</small>
                </button>
                <button class="export-option" data-format="summary">
                    <strong>Resumen Ejecutivo</strong>
                    <small>Texto consolidado</small>
                </button>
            </div>
            <div class="modal-actions">
                <button id="closeExportModal" class="btn btn--outline">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.catastralAnalyzer = new CatastralAnalyzer();
        });
    </script>
</body>
</html>
